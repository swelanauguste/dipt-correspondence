{% extends 'base.html' %}

{% load crispy_forms_tags %}

{% load md_extras %}

{% load humanize %}

{% block content %}
<h1>{{object.subject|upper}}
    {% if object.urgent %}
    <span class="text-warning"> - Urgent</span>
    {% endif %}
    {% if object.conf %}
    <span class="text-danger"> - Confidential</span>
    {% endif %}
</h1>
<hr>

<div class="text-bg-light  
    {% if object.conf %} border-danger border border-3 {% endif %} p-5 shadow col-lg-4 mx-auto"
    style="height: fit-content;">
    <p class="text-end me-3"><a class="edit-btn"
            href="{% url 'incoming-update' object.slug %}">Edit</a>
    </p>
    <hr>
    <p><strong>Subject: </strong>{{object.subject}}</p>
    <p><strong>Received: </strong>{{object.received}} <strong>from:
        </strong>{{object.r_from}}</p>
    <p><strong>Sender: </strong>{{object.sender}}</p>
    <p><strong>Dated: </strong>{{object.dated}}</p>
    <p><strong>Phone: </strong><a
            href="tel:{{object.phone}}">{{object.phone}}</a>
        <a href="tel:{{object.phone}}"> {{object.phone1}}</a>
    </p>
    {% if object.file %}
    <p><strong>Doc: </strong><a
            href="{{object.file.url}}">{{object.file.url}}</a></p>
    {% endif %}
    <p><strong>Notes: </strong>{{object.note|default:'-'}}</p>
    <p class="text-muted small"><strong>created:
        </strong>{{object.created_by|default:'-'}}
        {{object.created_at|naturaltime|default:'-'}}</p>
    <br>
    <hr>
    <br>
    <h3>Comments</h3>
    {% if object.pk %}
    {% if not object.is_closed %}
    <form action="{% url 'incoming-add-comment' object.slug %}"
        method="post">
        {% csrf_token %}
        {{comments_form|crispy}}
        <div class="text-end">
            <button type="submit">Submit</button>
        </div>
    </form>
    <br>
    <hr>
    <br>
    {% endif %}
    <div class="mt-3">
        {% for comment in object.comments.all %}
        <div class="border rounded-4 p-3">
            <span>{{comment.comment|markdown|safe}} </span>
            <p class="text-end small"><a
                    href="{{comment.created_by.get_absolute_url}}"><span>{{comment.created_by}}</span></a>
                <span>{{comment.created_at|naturaltime}}</span>
            </p>
        </div>
        <br>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% endblock content %}